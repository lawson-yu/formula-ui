"use strict";(self.webpackChunklsbiz_ui=self.webpackChunklsbiz_ui||[]).push([[572],{31572:function(Xa,H,u){u.r(H),u.d(H,{Button:function(){return W},DataMenu:function(){return J},FormulaPage:function(){return pa},FormulaView:function(){return la},Pagination:function(){return ra},TablePage:function(){return Za},useMount:function(){return Ra},usePagination:function(){return ia},usePaginationCom:function(){return Ua}});var ua=u(84875),F=u.n(ua),j=u(50959),sa={btn:"FB2xyNB12JwnME1nCsRT"},l=u(11527),oa=function(a){var t=a.className,n=a.style,e=a.children,r=a.icon,c=a.disabled,S=a.onClick,C=function(){c||S==null||S()};return(0,l.jsxs)("div",{className:F()(sa.btn,t),style:n,onClick:C,children:[r,e!=null?e:"\u6309\u94AE"]})},W=oa,ca=u(54306),I=u.n(ca),R=u(58572),da=u(32699),z={block:"zbraI6m_E0mG7kX01x5t",scrollBlock:"dM4nBmJDksy4C39KHH_m",listGroup:"REpaeWkDHKwWmHW0lz28",open:"c6199h8d1Mpc_MvDMx60",listGroupChildren:"lHJHNej_9qwmiPGz3vwb",listGroupItem:"CGC6XhRIycc2sjoooiST",item:"FtnqkT32470ZhAtKNtw7",supItem:"UfxNMtFZY4XkTt3b0190",searchCtrl:"Qm9mU2tdMzwkXuzZaYTq",supTitle:"nraukqbRldoo9H1qcPvl"},va=function(a,t){return a.filter(function(n){var e;return n.label.includes(t)||((e=n.children)===null||e===void 0?void 0:e.some(function(r){return r.label.includes(t)}))})},fa=function(a){var t=a.className,n=a.onClick,e=a.dataSource,r=a.hasSearch,c=(0,j.useState)(e),S=I()(c,2),C=S[0],N=S[1],m=(0,j.useState)(new Set(e.map(function(f){return f.id}))),h=I()(m,2),g=h[0],d=h[1],x=(0,j.useState)(""),D=I()(x,2),v=D[0],o=D[1];e!==C&&(d(new Set(e.map(function(f){return f.id}))),N(e));var p=function(s){g.has(s)?g.delete(s):g.add(s),d(new Set(g))},y=function(s){o(s.target.value)},P=(0,j.useMemo)(function(){return va(C,v)},[C,v]);return(0,l.jsxs)("div",{className:F()(z.block,t),children:[!!r&&(0,l.jsx)(R.Z,{maxLength:30,className:z.searchCtrl,value:v,onChange:y,placeholder:"\u8BF7\u8F93\u5165\u6570\u636E\u540D\u79F0"}),(0,l.jsx)("div",{className:z.scrollBlock,children:(0,l.jsx)("div",{className:z.listBox,children:P.map(function(f){return(0,l.jsxs)("div",{className:F()(z.listGroup,g.has(f.id)&&z.open),children:[(0,l.jsx)("div",{className:z.listGroupItem,onClick:function(){return p(f.id)},children:f.label}),(0,l.jsx)("div",{className:z.listGroupChildren,children:(0,da.map)(f.children,function(s){return(0,l.jsx)("div",{className:F()(z.item,z.supItem),onClick:function(){return n==null?void 0:n(f,s)},children:s.label},s.id)})})]},f.id)})})})]})},J=fa,ha=u(25359),T=u.n(ha),ma=u(49811),V=u.n(ma),ga=u(57213),E=u.n(ga),U=u(81702),M={page:"xQ0066l4_L8bqfx9B3ot",menu:"fve2esmKn8XYBnp8CnLq",actions:"UXSzR5VMy4IdTFOAAAcP",btn:"VURM3VrzcUQKd3Iy2qJa",btnError:"SfBWRDU4Ku8cd9XhO4UQ",btnPrimary:"tC_Fr_0PXdwC2F7rXmQX"},Sa=U.Z.useForm,X=U.Z.Item,Ca=function(a){var t=function(s){},n=a.pageClassName,e=a.dataMenuClassName,r=a.formulaValue,c=a.dataSource,S=a.form,C=a.onDeleteBtn,N=a.onCancelBtn,m=a.onSubmitBtn,h=Sa(),g=I()(h,1),d=g[0];S&&(d=S);var x=(0,j.useState)(),D=I()(x,2),v=D[0],o=D[1];r!==v&&(o(r),d.setFieldsValue(E()({},r)));var p=function(s){s.preventDefault(),C==null||C()},y=function(s){s.preventDefault(),N()},P=function(){var f=V()(T()().mark(function s(B){return T()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:m(B);case 1:case"end":return b.stop()}},s)}));return function(B){return f.apply(this,arguments)}}();return(0,l.jsxs)("div",{className:F()(M.page,n),children:[(0,l.jsx)("div",{className:M.menu,children:(0,l.jsx)(J,{hasSearch:!0,className:e,dataSource:c,onClick:function(s){t("[".concat(s.parentId?"".concat(s.parentId,"_"):"").concat(s.id,"]"))}})}),(0,l.jsxs)(U.Z,{form:d,className:M.form,layout:"vertical",onFinish:P,children:[(0,l.jsx)(X,{name:"dataName",label:"\u6570\u636E\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6570\u636E\u5B57\u6BB5\u540D\u79F0"}],children:(0,l.jsx)(R.Z,{maxLength:50,placeholder:"\u8BF7\u8F93\u5165\u6570\u636E\u5B57\u6BB5\u540D\u79F0"})}),(0,l.jsx)(X,{name:"calculation",label:"\u6F14\u7B97\u6A21\u5F0F",validateTrigger:["onSubmit"],rules:[{required:!0,validator:function(){var f=V()(T()().mark(function B(G,b){return T()().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:if(b!=null&&b[0]){Z.next=2;break}throw new Error("\u8BF7\u8F93\u5165\u8BA1\u7B97\u516C\u5F0F");case 2:case"end":return Z.stop()}},B)}));function s(B,G){return f.apply(this,arguments)}return s}()}],children:(0,l.jsx)(la,{dataSource:c,callback:function(s){t=s}})}),(0,l.jsx)(X,{name:"unit",label:"\u5355\u4F4D",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5355\u4F4D"}],children:(0,l.jsx)(R.Z,{maxLength:30,placeholder:"	\u8BF7\u8F93\u5165\u5355\u4F4D"})}),(0,l.jsxs)("div",{className:M.actions,children:[(0,l.jsx)("button",{className:M.btnPrimary,type:"submit",children:"\u4FDD\u5B58"}),!!C&&(0,l.jsx)("button",{type:"button",className:M.btnError,onClick:p,children:"\u5220\u9664"}),(0,l.jsx)("button",{type:"button",className:M.btn,onClick:y,children:"\u53D6\u6D88"})]})]})]})},pa=Ca,k=u(15543),ba=u(90263),Q=["+","-","*","/","()","||","\u2211"],xa={"||":"abs()","\u2211":"sum()"},ja=Q.join("").split(""),O={container:"xnYmZjo54Ov9wirsmFto",operators:"b2a37_MuFIYxW1d4zn2T",operator:"izYkty6IR5kVFvCrYT3Z",editor:"eLA66jxDKpU1rHLYoHNu",widget:"INleuEIbMY2ypB4IJ8Mb"},Na=u(21140),w=u.n(Na),ya=u(63466),$=u.n(ya),Pa=u(68608),Da=u.n(Pa),Ba=u(58853),Ia=u.n(Ba),za=u(38888),Fa=u.n(za),Ma=u(52510),q=u.n(Ma),K={},ka=function(i){Ia()(t,i);var a=Fa()(t);function t(n){var e;return w()(this,t),e=a.call(this),q()(Da()(e),"label",void 0),e.label=n,e}return $()(t,[{key:"eq",value:function(e){return e.label===this.label}},{key:"toDOM",value:function(){var e=document.createElement("span"),r=K[this.label];return e.innerHTML=r||this.label,e.className=r?O.widget:"",e}}]),t}(k.l9),_=new k.Y1({regexp:/\[((\w|-)+)]/g,decoration:function(a){return k.p.replace({widget:new ka(a[1])})}}),Ka=function(a){K=a},La=function(a){return k.lg.fromClass(function(){function t(n){w()(this,t),q()(this,"placeholders",void 0),this.placeholders=_.createDeco(n),K=a}return $()(t,[{key:"update",value:function(e){this.placeholders=_.updateDeco(e,this.placeholders)}}]),t}(),{decorations:function(n){return n.placeholders},provide:function(n){return k.tk.atomicRanges.of(function(e){var r;return((r=e.plugin(n))===null||r===void 0?void 0:r.placeholders)||k.p.none})}})},Ta=u(93525),aa=u.n(Ta),ea=function(a){return["device","source"].includes(a.type)},na=function(a,t){var n=a.type==="operator"&&["abs","sum"].includes(a.value||"");return n?"".concat(a.value,"(").concat(t(),")"):a.value},ta=function(a){var t=a.sourceId,n=a.fieldId,e=a.value;return"".concat(t,"_").concat(n).concat(e?"_".concat(e):"")},L={toString:function(a){return a.reduce(function(t,n){return"".concat(t).concat(ea(n)?"[".concat(ta(n),"]"):na(n,function(){var e;return L.toString((e=n.specialCalculationDTOList)!==null&&e!==void 0?e:[])}))},"")},toLabel:function(a,t){return a.reduce(function(n,e){return"".concat(n).concat(ea(e)?t[ta(e)]||e.value:na(e,function(){var r;return L.toLabel((r=e.specialCalculationDTOList)!==null&&r!==void 0?r:[],t)}))},"")},toStringByLabel:function(a){function t(n){if(n!=null&&n.includes("sum(")||n!=null&&n.includes("abs(")){var e=n.indexOf("sum("),r=n.indexOf("abs("),c=e>r?r>=0?r:e:e>=0?e:r,S=n.indexOf(")",c)+1;return S<=0?n.slice(0,c).split(""):[].concat(aa()(n.slice(0,c).split("")),[n.slice(c,S)],aa()(t(n.slice(S,n.length))))}return n.split("")}return t(a)},toData:function(a){var t=L.toStringByLabel(a),n=[],e=!1,r=!1,c=0,S=0,C=((t==null?void 0:t.length)||0)-1,N=function(h){if(r){var g=t.slice(S,h).join("");n.push({type:"number",value:g})}};return t.forEach(function(m,h){switch(!0){case((m.includes("abs(")||m.includes("sum("))&&!e):{N(h),e=!1,r=!1,n.push({type:"operator",value:m.includes("abs(")?"abs":"sum",specialCalculationDTOList:L.toData(m.slice(4,m.length-1))});break}case(ja.includes(m)&&!e):{N(h),e=!1,r=!1,n.push({type:"operator",value:m});break}case m==="[":{N(h),e=!0,r=!1,c=h;break}case m==="]":{e=!1,r=!1;var g=t.slice(c+1,h).join(""),d=g.split("_"),x=I()(d,3),D=x[0],v=x[1],o=x[2];n.push({sourceId:D,fieldId:v,value:o,type:o?"device":"source"});break}default:e||(r||(S=h),r=!0,h===C&&N(h+1))}}),n}};function la(i){var a,t=i.callback,n=i.dataSource,e=i==null||(a=i.value)===null||a===void 0?void 0:a[0],r=(0,j.useRef)(null),c=(0,j.useState)(0),S=I()(c,2),C=S[0],N=S[1],m=(0,j.useState)(""),h=I()(m,2),g=h[0],d=h[1],x=(0,j.useMemo)(function(){var v={};return n.forEach(function(o){var p;(p=o.children)===null||p===void 0||p.forEach(function(y){v["".concat(o.id,"_").concat(y.id)]=y.label})}),v},[n]),D=function(o){var p=xa[o],y=C+(p||o).length;d(g.slice(0,C)+(p||o)+g.slice(C)),setTimeout(function(){try{var P,f,s,B;(P=r.current)===null||P===void 0||(f=P.view)===null||f===void 0||f.focus(),(s=r.current)===null||s===void 0||(B=s.view)===null||B===void 0||B.dispatch({selection:{anchor:y}})}catch(G){}},100)};return(0,j.useEffect)(function(){t&&t(D)}),(0,j.useEffect)(function(){var v,o=L.toData(g);(v=i.onChange)===null||v===void 0||v.call(i,[L.toLabel(o,x),o])},[g,x]),(0,j.useEffect)(function(){if(e){var v,o,p=L.toString((v=(o=i.value)===null||o===void 0?void 0:o[1])!==null&&v!==void 0?v:[]);g!==p&&(d(p),setTimeout(function(){try{var y,P;(y=r.current)===null||y===void 0||(P=y.view)===null||P===void 0||P.dispatch({selection:{anchor:p.length}})}catch(f){}},100))}},[e]),(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{className:O.container,children:[(0,l.jsx)("div",{className:O.operators,children:Q.map(function(v){return(0,l.jsx)("div",{className:O.operator,onClick:function(){return D(v)},children:v},v)})}),x&&(0,l.jsx)(ba.ZP,{ref:r,theme:"none",value:g,height:"160px",className:O.editor,basicSetup:!1,extensions:[La(x),k.tk.lineWrapping],onChange:function(o){return d(o)},onStatistics:function(o){N(o.selectionAsSingle.from)}})]})})}var Ea=u(48277),Y={pagination:"C8ABaoEmIcEnvyjPu_B8",small:"aUrgtglspD07m8hNq14w",right:"NCvzD6Dkbpk5O2CzRRhg",select:"AjhRLMo02bBUmPBU3L46"},Oa=function(a){var t=a.current,n=t===void 0?1:t,e=a.total,r=a.pageSize,c=r===void 0?10:r,S=a.className,C=a.pageSizeOptions,N=C===void 0?[10,20,50,100]:C,m=a.onChange,h=a.paginationProps,g=Math.ceil(e/c);return(0,l.jsxs)("div",{className:F()(Y.pagination,S),children:[(0,l.jsxs)("div",{children:["\u6BCF\u9875\u663E\u793A ",c," \u6761\uFF0C\u5171 ",g," \u9875\uFF0C\u5F53\u524D"," ","".concat(n,"/").concat(g)]}),(0,l.jsxs)("div",{className:Y.right,children:[(0,l.jsx)(Ea.Z,E()({current:n,pageSize:c,total:e,showSizeChanger:!1,jumpPrevIcon:function(){return(0,l.jsx)("span",{children:"..."})},jumpNextIcon:function(){return(0,l.jsx)("span",{children:"..."})},onChange:m},h)),"\u6BCF\u9875\u663E\u793A",m?(0,l.jsx)("select",{className:F()(Y.select,"select"),value:c,onChange:function(x){return m==null?void 0:m(n,x.target.value)},children:N.map(function(d){return(0,l.jsx)("option",{value:d,children:d},d)})}):c,"\u6761\u8BB0\u5F55"]})]})},ra=Oa,Aa=u(14317),A={container:"_3Q_LXMTrkaLwVDsT9JN",btnWrap:"M4SkLO9l4CAbqeDzwVcN",plus:"hLAGobdQOYErtdiuKZU8",card:"D8093npDUE81jaXvFwBB",content:"GAhdS2zecsefeCqXgduz",empty:"yu_zCOVerkUsbGcVZLgY",btn:"u3hgALIu90oaBA9HOtmn",actions:"nMyexFqJh_Egt0ugummn"},Ga=function(a){var t=a.footer,n=a.columns,e=a.extra,r=a.tableClassName,c=a.tableProps,S=a.btnProps,C=a.requestInfo,N=a.className,m=a.style,h=ia(C),g=h.dataSource,d=h.current,x=h.pageSize,D=h.total,v=h.fetch,o=function(y,P){v({current:y,pageSize:P})};return(0,l.jsx)("div",{className:F()("table-page-container",A.container,N),style:m,children:(0,l.jsxs)("div",{className:F()("table-page-container-card",A.card),children:[e||(0,l.jsx)("div",{className:A.btnWrap,children:(0,l.jsx)(W,E()(E()({icon:"+"},S),{},{children:"\xA0\xA0\u65B0\u589E\u6570\u636E"}))}),(0,l.jsx)("div",{className:A.content,children:(0,l.jsx)(Aa.ZP,E()({className:r,data:g,columns:n},c))}),t||(0,l.jsx)(ra,{total:D,pageSize:x,current:d,onChange:o})]})})},Za=Ga;function Ra(i){(0,j.useEffect)(function(){i==null||i()},[])}function ia(i){var a=i.defaultPageSize,t=a===void 0?10:a,n=i.defaultCurrent,e=n===void 0?1:n,r=i.apiCallback,c=i.errorCallback,S=(0,j.useState)(!1),C=I()(S,2),N=C[0],m=C[1],h=(0,j.useState)({pageSize:t,current:e,dataSource:[],total:0}),g=I()(h,2),d=g[0],x=g[1],D=(0,j.useCallback)(V()(T()().mark(function v(){var o,p,y,P,f,s,B=arguments;return T()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return o=B.length>0&&B[0]!==void 0?B[0]:{},b.prev=1,m(!0),b.next=5,r(E()({current:d.current,pageSize:d.pageSize},o));case 5:p=b.sent,y=p.current,P=p.pageSize,f=p.total,s=p.data,x({dataSource:s,current:y,pageSize:P,total:f}),b.next=16;break;case 13:b.prev=13,b.t0=b.catch(1),c==null||c(b.t0);case 16:return b.prev=16,m(!1),b.finish(16);case 19:case"end":return b.stop()}},v,null,[[1,13,16,19]])})),[r,c,d]);return(0,j.useEffect)(function(){D()},[]),{isLoading:N,current:d.current,pageSize:d.pageSize,total:d.total,dataSource:d.dataSource,fetch:D}}var Va=function(){return(0,l.jsx)(l.Fragment,{})},Ua=Va}}]);
